# В этом файле собраны задания и ответы, которые реализуют:

**-Вложенный запрос, возвращающий одно значение**

**-Использование вложенного запроса в выражении**

**-Вложенный запрос, оператор IN**

**-Вложенный запрос, операторы ANY и ALL**

**-Вложенный запрос после SELECT**

## Задание №1
Вывести информацию (автора, название и цену) о  книгах, цены которых меньше или равны средней цене книг на складе. Информацию вывести в отсортированном по убыванию цены виде. 
Среднее вычислить как среднее по цене книги.

### Решение для задания №1
```
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price <= (
    SELECT 
      AVG(price) 
    FROM 
      book
  ) 
ORDER BY 
  title;
```
![image](https://github.com/00Julie00/SQL/assets/115406267/38b3e306-ce2c-4f09-9fb9-b784e0c16f2d)

## Задание №2
Вывести информацию (автора, название и цену) о тех книгах, цены которых превышают минимальную цену книги на складе не более чем на 150 рублей в отсортированном по возрастанию цены виде.

### Решение для задания №2
```
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  ABS(
    price - (
      SELECT 
        MIN(price) 
      FROM 
        book
    )
  ) <= 150 
ORDER BY 
  price;
```
![image](https://github.com/00Julie00/SQL/assets/115406267/395ed45e-548d-46ea-a683-40a17e17ef7f)

## Задание №3
Вывести информацию (автора, книгу и количество) о тех книгах, количество экземпляров которых в таблице `book` не дублируется.

**Пояснение:** 
В таблице `book` в столбце `amount` хранится количество экземпляров каждой книги:
```
+-----------------------+--------+
| title                 | amount |
+-----------------------+--------+
| Мастер и Маргарита    | 3      |
| Белая гвардия         | 5      |
| Идиот                 | 10     |
| Братья Карамазовы     | 3      |
| Игрок                 | 10     |
| Стихотворения и поэмы | 15     |
+-----------------------+--------+
```

В соответствии с этой таблицей:

- количество экземпляров книг "Мастер и Маргарита" и "Братья Карамазовы" одинаково и равно 3 (так как число 3 встречается в таблице два раза, книги с таким количеством не подходят под условие);
- количество экземпляров книг "Идиот" и "Игрок" тоже одинаково и равно 10 (не подходят под условие);
- количество экземпляров книги "Белая гвардия равно" 5, при этом в таблице нет других книг, количество экземпляров которых равно 5, следовательно, эта книга подходит под условие задачи (так как количество экземпляров 5 в таблице не дублируется);
- количество экземпляров книги "Стихотворение и поэмы"  - 15, в таблице нет других книг, количество экземпляров которых тоже равно 15, следовательно, и эта книга подходит под условие.
Таким образом, необходимо вывести те строки таблицы, у которых числа в столбце `amount` не повторяются.

### Решение для задания №3
```
SELECT 
  author, 
  title, 
  amount 
FROM 
  book 
WHERE 
  amount IN (
    SELECT 
      amount 
    FROM 
      book 
    GROUP BY 
      amount 
    HAVING 
      COUNT(amount) = 1
  );
```
![image](https://github.com/00Julie00/SQL/assets/115406267/6eb3a3b1-73af-4e72-8609-dfa988f3b464)

## Задание №4
Вывести информацию о книгах(автор, название, цена), цена которых меньше самой большой из минимальных цен, вычисленных для каждого автора.
### Решение для задания №4
```
SELECT 
  author, 
  title, 
  price 
FROM 
  book 
WHERE 
  price < ANY (
    SELECT 
      MIN(price) 
    FROM 
      book 
    GROUP BY 
      author
  );
```
![image](https://github.com/00Julie00/SQL/assets/115406267/f00cc422-52d7-4163-9e52-9023db871bc0)

## Задание №5
Посчитать сколько и каких экземпляров книг нужно заказать поставщикам, чтобы на складе стало одинаковое количество экземпляров каждой книги, равное значению самого большего количества экземпляров одной книги на складе. Вывести название книги, ее автора, текущее количество экземпляров на складе и количество заказываемых экземпляров книг. Последнему столбцу присвоить имя **Заказ**. В результат не включать книги, которые заказывать не нужно.

**Пояснение:** 
Поскольку книгу с максимальным количеством экземпляров заказывать не нужно, в условии отбора запроса укажите, что книгу с максимальным значением количества в результирующую таблицу не включать. 
### Решение для задания №5
```
SELECT 
  title, 
  author, 
  amount, 
  FLOOR(
    (
      SELECT 
        MAX(amount) 
      FROM 
        book
    )- amount
  ) AS Заказ 
FROM 
  book 
WHERE 
  amount NOT IN (
    SELECT 
      MAX(amount) 
    FROM 
      book
  );
```
![image](https://github.com/00Julie00/SQL/assets/115406267/8146eac0-c41c-4981-881c-88c641378f0f)

## Задание №6 (Придумать запрос самостоятельно)
Нужно заказать книги у поставщиков, чтобы на складе стало одинаковое количество каждой книги. Это количество должно быть равно самому большому количеству книг одного вида на складе. Надо написать список книг, их авторов, количество которое уже находится на складе и цену для каждой книги. Также в таблице нужно указать необходимое количество книг для дозаказа в столбце **Заказ** , а также сумму для дозакза нужного количества экземпляров, рассчитанную по себестоимости книг. Название последнего столбца списка должно быть **Суммы для дозаказа**. Не нужно включать книги, которые уже есть в достаточном количестве.
### Решение для задания №6
```
SELECT 
  title AS Название_книги, 
  author AS Автор, 
  amount AS Количество, 
  price AS Цена, 
  (
    SELECT 
      MAX(amount) 
    FROM 
      book
  ) - amount AS Заказ, 
  (
    (
      SELECT 
        MAX(amount) 
      FROM 
        book
    ) - amount
  ) * ROUND(
    SUM(
      price /(1 + 0.2)
    ), 
    2
  ) AS Сумма_для_дозаказа 
FROM 
  book 
WHERE 
  (
    SELECT 
      MAX(amount) 
    FROM 
      book
  ) - amount <> 0 
GROUP BY 
  title, 
  author, 
  amount, 
  price 
ORDER BY 
  Заказ;
```
![image](https://github.com/00Julie00/SQL/assets/115406267/50d7ecfa-1cc4-47fa-a3c8-dae75cc6c5af)
